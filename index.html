<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Title of the document</title>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                background:#fff;
                padding:0;
                margin:0;
                font-weight: bold;
                overflow:hidden;
            }
        </style>
        <script src="lib/three.min.js"></script>
        <script src="lib/stats.min.js"></script>
        <script src="bundle.js"></script>
    </head>
    <body>
    </body>
    <!-- simulation & parsing -->
    <script type="text/javascript">
        var simulationData  = {
                robots:{},
                lines:[]
            };

        var replayData;
        var currentFrame;
        var parseFile = null;

        function parse(file){
            replayData = getData(file);
            currentFrame = 0;
            simulationData.robots = {};
            simulationData.lines = [];
        }

		function isMapParsed(){
			return replayData!=null && replayData.maplist.length>0 && replayData.maplist[0].frames.length>0;
		}

        function simulate(){
            if(replayData==null || replayData.maplist.length==0 || replayData.maplist[0].frames.length<=currentFrame+1)
                return;
            var frame = replayData.maplist[0].frames[currentFrame];
            var sigs = frame.signals;
            simulationData.lines = [];
            for(var i =0;i<sigs.length;i++){
                var sig = sigs[i];
                if(sig.type=="spawn"){
                    var robot = {
                        id:sig.robotID,
                        loc: sig.loc,
                        team: sig.team,
                        type: sig.robotType,
						lastloc: sig.loc,
						hasInterp: false
                    };
                    simulationData.robots[robot.id] = robot;
                }else if(sig.type=="move"){
                    var robot = simulationData.robots[sig.robotID];
					robot.lastloc = robot.loc;
                    robot.loc = sig.loc;
					robot.hasInterp = true;
                }else if(sig.type=="attack"){
                    var robot = simulationData.robots[sig.robotID];
                    simulationData.lines.push([robot,sig.loc]);
                }else if(sig.type=="death"){
                    delete simulationData.robots[sig.robotID];
                }
            }
            currentFrame++;
        }
    </script>
	<script src="renderer.js"></script>
</html>

